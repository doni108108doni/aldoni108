{
  "spec": {
    "title": "CSS Anchor Positioning",
    "url": "https://www.w3.org/TR/css-anchor-position-1/"
  },
  "algorithms": [
    {
      "name": "target anchor element",
      "href": "https://www.w3.org/TR/css-anchor-position-1/#target-anchor-element",
      "html": "To determine the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"target-anchor-element\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">target <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-element\" id=\"ref-for-anchor-element④\">anchor element</a></dfn> given a querying element <var>query el</var> and an optional <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-specifier\" id=\"ref-for-anchor-specifier\">anchor specifier</a> <var>anchor spec</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>If <var>anchor spec</var> was not passed,\nreturn the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#target-anchor-element\" id=\"ref-for-target-anchor-element②\">target anchor element</a> for <var>query el</var> given the <var>query el</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#default-anchor-specifier\" id=\"ref-for-default-anchor-specifier\">default anchor specifier</a>.</p>"
        },
        {
          "html": "To determine the <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"target-anchor-element\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">target <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-element\" id=\"ref-for-anchor-element④\">anchor element</a></dfn> given a querying element <var>query el</var> and an optional <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-specifier\" id=\"ref-for-anchor-specifier\">anchor specifier</a> <var>anchor spec</var>:",
          "rationale": "if",
          "steps": [
            {
              "html": "<p>If the Popover API defines an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#implicit-anchor-element\" id=\"ref-for-implicit-anchor-element⑤\">implicit anchor element</a> for <var>query el</var> which is an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#acceptable-anchor-element\" id=\"ref-for-acceptable-anchor-element①\">acceptable anchor element</a> for <var>query el</var>,\nreturn that element.</p>"
            },
            {
              "html": "<p>Otherwise, return nothing.</p>"
            }
          ]
        },
        {
          "html": "<p>Otherwise, <var>anchor spec</var> is a <a class=\"production css\" data-link-type=\"type\" href=\"https://www.w3.org/TR/css-values-4/#typedef-dashed-ident\" id=\"ref-for-typedef-dashed-ident⑤\">&lt;dashed-ident&gt;</a>.\nReturn the last element <var>el</var> in tree order\nthat satisfies the following conditions:</p>\n      <ul>\n       <li data-md=\"\">\n        <p><var>el</var> is an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-element\" id=\"ref-for-anchor-element⑤\">anchor element</a> with an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-name\" id=\"ref-for-anchor-name①③\">anchor name</a> of <var>anchor spec</var>.</p>\n       </li><li data-md=\"\">\n        <p><var>el</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#anchor-name\" id=\"ref-for-anchor-name①④\">anchor name</a> and <var>anchor spec</var> are both associated with the same <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree\" id=\"ref-for-concept-tree\">tree</a> <a data-link-type=\"dfn\" href=\"https://dom.spec.whatwg.org/#concept-tree-root\" id=\"ref-for-concept-tree-root\">root</a>.</p>\n        \n       </li><li data-md=\"\">\n        <p><var>el</var> is an <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#acceptable-anchor-element\" id=\"ref-for-acceptable-anchor-element②\">acceptable anchor element</a> for <var>query el</var>.</p>\n      </li></ul>\n      <p>If no element satisfies these conditions,\nreturn nothing.</p>"
        }
      ]
    },
    {
      "name": "apply a position option",
      "href": "https://www.w3.org/TR/css-anchor-position-1/#apply-a-position-option",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"apply-a-position-option\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">apply a position option</dfn> to an element <var>el</var>,\n\tgiven a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#position-option\" id=\"ref-for-position-option⑥\">position option</a> <var>new styles</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>With <var>new styles</var> inserted into the cascade\nin the <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#position-fallback-origin\" id=\"ref-for-position-fallback-origin\">position fallback origin</a>,\nresolve the cascade,\nand perform enough layout to determine <var>el</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-5/#used-value\" id=\"ref-for-used-value①\">used styles</a>.</p>"
        },
        {
          "html": "<p>Return <var>el</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-cascade-5/#used-value\" id=\"ref-for-used-value②\">used styles</a>.</p>"
        }
      ]
    },
    {
      "name": "determine the position fallback styles",
      "href": "https://www.w3.org/TR/css-anchor-position-1/#determine-the-position-fallback-styles",
      "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-position-fallback-styles\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the position fallback styles</dfn> of an element <var>el</var>:",
      "rationale": ".algorithm",
      "steps": [
        {
          "html": "<p>Let <var>base styles</var> be the current used styles of <var>el</var>.</p>"
        },
        {
          "html": "To <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"determine-the-position-fallback-styles\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">determine the position fallback styles</dfn> of an element <var>el</var>:",
          "rationale": "let",
          "steps": [
            {
              "html": "<p>Let <var>adjusted styles</var> be the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#apply-a-position-option\" id=\"ref-for-apply-a-position-option①\">applying a position option</a> <var>option</var> to <var>el</var>.</p>"
            },
            {
              "html": "<p>Let <var>el rect</var> be the size and position of <var>el</var>’s margin box,\nwhen laid out with <var>adjusted styles</var>.\nLet <var>cb rect</var> be the size and position of <var>el</var>’s <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-position-3/#inset-modified-containing-block\" id=\"ref-for-inset-modified-containing-block⑧\">inset-modified containing block</a>.</p>"
            },
            {
              "html": "<p>If <var>el</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#snapshotted-scroll-offset\" id=\"ref-for-snapshotted-scroll-offset①\">snapshotted scroll offset</a>,\nsubtract it from the position of both <var>el rect</var> and <var>cb rect</var>.</p>"
            },
            {
              "html": "<p>If <var>el rect</var> is not fully contained within <var>cb rect</var>, <a data-link-type=\"dfn\" href=\"https://infra.spec.whatwg.org/#iteration-continue\" id=\"ref-for-iteration-continue\">continue</a>.</p>"
            },
            {
              "html": "<p>Set <var>option</var> as <var>el</var>’s <dfn class=\"dfn-paneled has-dfn-panel\" data-dfn-type=\"dfn\" data-noexport=\"\" id=\"last-successful-position-option\" role=\"button\" aria-expanded=\"false\" tabindex=\"0\">last successful position option</dfn>.\nReturn <var>adjusted styles</var>.</p>"
            }
          ]
        },
        {
          "html": "<p class=\"assertion\">Assert: The previous step finished without finding a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#position-option\" id=\"ref-for-position-option⑦\">position option</a> that avoids overflow.</p>"
        },
        {
          "html": "<p>If <var>el</var> has a <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#last-successful-position-option\" id=\"ref-for-last-successful-position-option\">last successful position option</a>,\nreturn the result of <a data-link-type=\"dfn\" href=\"https://www.w3.org/TR/css-anchor-position-1/#apply-a-position-option\" id=\"ref-for-apply-a-position-option②\">applying a position option</a>,\nusing that option,\nto <var>el</var>.</p>"
        },
        {
          "html": "<p>Return <var>base styles</var>.</p>"
        }
      ]
    }
  ]
}